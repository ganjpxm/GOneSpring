<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="description" content="Personal,Software,Hardeware">
  <meta name="author" content="Gan Jianping">
  <link rel="icon" href="../../resource/image/ic_jp_circle.png">
  <title id="title">JPing</title>

  <link rel="stylesheet" href="../../resource/framework/jquery-ui/v1.11/jquery-ui.css">
  <link rel="stylesheet" href="../../resource/framework/bootstrap/v3.2/bootstrap.css">
  <link rel="stylesheet" href="../../resource/framework/henry/v3.0/style.css">
  <link rel="stylesheet" href="../../resource/css/font-awesome/v4.2/font-awesome.css">
  <link rel="stylesheet" href="../../resource/component/chosen/v1.1/chosen.css">
  <link rel="stylesheet" href="../../resource/component/fileupload/v5.41/fileupload.css">
  <link rel="stylesheet" href="../../resource/component/magnific-popup/v0.9/magnific-popup.css">
  <link rel="stylesheet" href="../../resource/framework/jp/jp.css">
</head>
<body>
  <!-- ***************************************************** Menu ******************************************************* -->
  <div class="navbar navbar-fixed-top">
      <div class="navbar navbar-inverse navbar-static-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand font-extra-bold" href="home.html">&nbsp;&nbsp;&nbsp;<span id="brand-name"></span>&nbsp;&nbsp;&nbsp;</a>
          </div>
          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav" style="font-size:16px;">
              <li class="active" style="display:none;"><a href="#"><i class="fa fa-home fa-fw"></i><span id="menu-home"></span></a></li>
              <li class="active"><a href="#"><i class="fa fa-globe fa-fw"></i> <span id="menu-websites"></span></a></li>
              <li><a href="articles.html"><i class="fa fa-book fa-fw"></i> <span id="menu-articles"></span></a></li>
              <li><a href="images.html"><i class="fa fa-picture-o fa-fw"></i> <span id="menu-images"></span></a></li>
              <li><a href="#contact"><i class="fa fa-volume-up fa-fw"></i> <span id="menu-audios"></span></a></li>
              <li><a href="#contact"><i class="fa fa-video-camera fa-fw"></i> <span id="menu-videos"></span></a></li>
              <li><a href="#contact"><i class="fa fa-cloud-download fa-fw"></i> <span id="menu-download"></span></a></li>
              <!-- <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Demo <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li><a href="#">Action</a></li>
                  <li><a href="#">Another action</a></li>
                  <li><a href="#">Something else here</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Nav header</li>
                  <li><a href="#">Separated link</a></li>
                  <li><a href="#">One more separated link</a></li>
                </ul>
              </li> -->
            </ul>
            <ul class="nav navbar-nav navbar-right"  style="font-size:16px;">
              <li>
              	<a id="login-out-menu" name="login" href="javascript:showLoginPanelOrLogout();" >
              		<i class="fa fa-sign-in fa-fw"></i> <span id="menu-login"></span>
              	</a>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"> 
                	<img id="img-language" style="height:18px;"> <span class="caret"></span> 
                </a>
	              <ul class="dropdown-menu" role="menu">
	                <li>
	                  <a id="login-out-menu" name="login" href="javascript:changeLanguage('zh_CN');" >
	              		<img src="../../resource/image/ic_flag_cn.png" alt="中文" style="height:18px;"> 中文
	              	  </a>
	              	</li>
	                <li>
	              	<a id="login-out-menu" name="login" href="javascript:changeLanguage('en_SG');" > 
	              		<img src="../../resource/image/ic_flag_us.png" alt="English" style="height:18px;"> English
	              	</a>
	              </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
  </div>

  <!-- ***************************************************** Content ******************************************************* -->
  <div>
 	<div class="container">
	  <div style="margin-top:50px;">
	    <div>
		    <div class="input-group">
			  <span id="website-tags-btn" class="input-group-addon" style="cursor:pointer;"><i class="fa fa-tags"></i></span>
			  <span id="search-condition-btn" class="input-group-addon" style="cursor:pointer;"><i class="fa fa-filter"></i></span>
			  <input id="keywords" name="keywords" type="text" class="form-control" value="" />
			  <span id="search-btn" class="input-group-addon" style="cursor:pointer;"><i class="fa fa-search"></i></span>
			  <span id="operation-btn" class="input-group-addon" style="cursor:pointer;"><span id="totalNumber" class="badge" style="color:white;background-color:#1abc9c;"></span></span>
			</div>
		</div>
	  </div>
	  <div id="search-condition-div" class="row" style="display:none;margin:5px 0px;">
	  		<div id='role-ids-div' class="col-md-3" style="display:none;padding:2px;">
				<select id="role-ids" name="roleIds" class="form-control"></select>
			</div>
			<div class="col-md-3" style="padding:2px;">
				<select id="field" name="field" class="form-control">
				  <option value="all" >All</option>
				  <option value="tag" >Tag</option>
				  <option value="name">Name</option>
				</select>
			</div>
			<div class="col-md-3" style="padding:2px;">
				<select id="search-lang" name="lang" class="form-control">
				  <option value="all" >All</option>
				  <option value="en_SG">English</option>
				  <option value="zh_CN">中文</option>
				</select>
			</div>
			<div class="col-md-3" style="padding:2px;">
				<select id="order-by" name="orderBy" class="form-control">
				  <option value="displayNo asc, menuName asc" >Display No. &uarr;</option>
				  <option value="createDateTime desc">Create Datetime &darr;</option>
				  <option value="modifyTimestamp desc">Modify Datetime &darr;</option>
				</select>
			</div>
	  </div>
	  <div id="website-tag-btns" style="display:none;"></div>
	  <div style="clear:both;"></div>
	  <div id="website-operate-btns" style="display:none;">
	  	 <a id="edit-website-btn" href="javascript:editWebsites();" class="btn btn-primary btn-xs jp-hide jp-fr" role="button" style="margin:4px;">
	  	 	<i class="fa fa-edit"></i> <span id="edit-website"></span></a>
	  	 <a href="javascript:showWebsiteAddPanel();" class="btn btn-primary btn-xs" role="button" style="float:right;margin:4px;">
	  	 	<i class="fa fa-plus"></i> <span id="add-website"></span></a>
	  </div>
	  <div style="clear:both;"></div>
	  <div class="jp-box-big" style="margin-top:5px;">
	    <div id="website-cells" style="display:block;"> 
		  <!-- <div class="jp-cell"><img src="../../resource/image/ic_logo_google.png" height="20"> <a href='http://www.google.com'>Google</a></div> -->
		  <div class="jp-tc jp-theme-color"><i class="fa fa-spinner fa-spin fa-3x" style="margin-top:50px;"></i></div>
		</div>
	  </div>
	</div>
  </div>
  
  <hr class="featurette-divider">
  <footer>
    <div style="background-color:#1abc9c; text-align:center;color:white;padding:20px;margin-top:-30px;">
        <p>Email : ganjpxm@gmail.com</p>
    	<p>&copy; 2014 Gan Jianping &middot;</p>
    </div>
  </footer>

  <!-- ******************************************* magnific-popup Panel ************************************************** -->
  <div id="login-in-panel" class="mfp-hide white-popup-block" style="max-width:400px;">
    <form id="login-form" action="http://www.ganjianping.com:8080/jping/web/login" method="post">
	  <h3 id="login-title" class="jp-tc"></h3>
	  <div class="input-group jp-mt30">
		<span class="input-group-addon"><i class="fa fa-user"></i></span>
		<input id="user-cd" name="userCd" class="form-control placeholder-no-fix" autocomplete="off" placeholder="" tabindex="1"/>
	  </div>
	  <div class="input-group jp-mt30">
		<span class="input-group-addon"><i class="fa fa-lock"></i></span>
		<input id="password" name="password" class="form-control placeholder-no-fix" type="password" autocomplete="off" placeholder="" tabindex="2" />
	  </div>
	  <div id="login-error-info" class="jp-red jp-tc"></div>
	  <div id="login-btn" class="jp-mt30 jp-mb30">  
		<a href="javascript:login();" class="btn btn-primary" style="height:40px;width:100%;" role="button" tabindex="3"><i class="fa fa-sign-in"></i> <span id="btn-login"></span></a>        
	  </div>
	  <div id="login-processing-icon" class="jp-tc jp-mt10 jp-mb10 jp-hide"><i class="fa fa-spinner fa-spin fa-3x jp-theme-color"></i></div>
	</form>    
  </div>
  <div id="website-panel" class="white-popup-block mfp-hide" style="max-width:650px;">
    <form id="website-form" action="http://www.ganjianping.com:8080/jping/web/websiteInfo/save" method="post">
      <input id="website-lang" name="lang" type="hidden" value="en_SG"/>
      <input id="website-uuid" name="uuid" type="hidden"/>
      <input id="website-tags" name="websiteTags" type="hidden"/>
      <input id="website-role-ids" name="roleIds" type="hidden"/>
	  <h3 style="text-align:center;"><img id="website-logo" src='' style='height:30px;margin-right:5px;'/> <span id="add-website-title"></span> </h3>
	  <button title="Close" type="button" class="mfp-close" style="color:#333;">×</button>
	  <input id="website-name" name="websiteName" class="form-control" type="text" placeholder="" tabindex="1">
	  <input id="website-url" name="websiteUrl" class="form-control" type="text" placeholder="" style="margin-top:10px;" tabindex="2">
	  <div style="margin-top:15px;">
	    <select id="website-tag" name="websiteTag" data-placeholder="" class="form-control chosen-select" multiple tabindex="3"></select>
      </div>
      <div id="website-tags-error" style="color:red;margin-top:5px;margin-bottom:5px;"></div>
	  <div class="form-group" style="margin-top:10px;">
	    <div class="input-group">
	      <input id="website-logo-url" name="websiteLogoUrl" class="form-control" type="text" placeholder="" tabindex="4">
	      <div class="input-group-addon" style="padding:2px;">
	      	<label class="fileinput-button" style="height:30px;margin-top:-15px;margin-bottom:-30px;">
			  <input type="hidden" name="folder" value="logo"/>
			  <button type="button" class="btn btn-default btn-sm" style="background-color:#eee;border:0px;">
				<i class="fa fa-cloud-upload"></i>
			  </button>
			  <input id="upload-website-logo-btn" type="file" name="file" data-url="http://www.ganjianping.com:8080/jping/web/uploadFile" multiple></input>
			</label>
	      </div>
	    </div>
	  </div>
	  <input id="website-display-no" name="displayNo" class="form-control" type="number" placeholder="" style="margin-top:10px;" tabindex="5">
	  <div id="website-roles" class="jp-mt15 jp-hide">
	  <select id="website-role-id" name="roleId" data-placeholder="" class="form-control chosen-select" multiple tabindex="6"></select>
      </div>
	</form>
	<div id="save-website-error-info" class="jp-red jp-tc"></div>
	<div id="save-website-btn" style="height:60px;margin-top:20px;text-align:center;"> 
	  <a href="javascript:dismiss();" class="btn btn-default" style="width:100px;" role="button"><i class="fa fa-remove"></i> <span id="cancel-website"></span></a> 
	  <a href="javascript:saveWebsite();" class="btn btn-primary" style="width:200px;" role="button"><i class="fa fa-floppy-o"></i> <span id="save-website"></span></a>     
	</div>
	<div id="save-website-processing-icon" class="jp-tc jp-mt10 jp-mb10 jp-hide"><i class="fa fa-spinner fa-spin fa-3x jp-theme-color"></i></div>
  </div>
  
  <div id="tags-panel" class="mfp-hide white-popup-block">
    <form id="tags-form" action="http://www.ganjianping.com:8080/jping/web/tags/save" method="post"> 
	  <input id="tags-uuid" name="uuid" type="hidden"/>
	  <h3 id="tags-title" style="text-align:center;">Tags</h3>
	  <button title="Close" type="button" class="mfp-close" style="color:#333;">×</button>
	  <textarea id="two-level-tags" name="twoLevelTags" class="form-control" placeholder="Tag Category:Tag1,Tag2;"></textarea>
	</form>   
	<div id="save-tags-error-info" class="jp-red jp-tc"></div> 
	<div id="save-tags-btn" style="height:60px;margin-top:20px;text-align:center;"> 
	    <a href="javascript:saveTags();" class="btn btn-primary" style="width:250px;" role="button"><i class="fa fa-floppy-o"></i> <span id="save-tags"></span></a>   
	</div>
	<div id="save-tags-processing-icon" class="jp-tc jp-mt10 jp-mb10 jp-hide"><i class="fa fa-spinner fa-spin fa-3x jp-theme-color"></i></div>
  </div>
  
  <div id="processing-panel" class="mfp-hide white-popup-block" style="max-width:60px;background-color:#1abc9c;opacity:0.65;border-radius:4px;">
    <!-- <div style="float:right;margin-top:-10px;margin-right:-5px;font-size:10px;cursor:pointer;" onclick="closeProcessingPanel();"><i class="fa fa-times"></i></div> -->
    <div><i class="fa fa-spinner fa-spin fa-3x" style="text-align:center;color:white;"></i></div>
  </div>
</body>
<script src="../../resource/js/jquery/jquery-1.11.1.js"></script>
<script src="../../resource/framework/jquery-ui/v1.11/jquery-ui.js"></script>
<script src="../../resource/framework/bootstrap/v3.2/bootstrap.js"></script>
<script src="../../resource/framework/henry/v3.0/henry.js"></script>
<script src="../../resource/framework/henry/v3.0/tools.js"></script>
<script src="../../resource/framework/henry/v3.0/lang/en.js"></script>
<script src="../../resource/component/chosen/v1.1/jquery.chosen.js"></script>
<script src="../../resource/component/fileupload/v5.41/jquery.fileupload.js"></script>
<script src="../../resource/component/magnific-popup/v0.9/jquery.magnific-popup.js"></script>
<script src="../../resource/js/jquery/jquery.form-3.51.js"></script>
<script src="../../resource/js/jquery/jquery.validate-1.13.js"></script>
<script src="../../resource/js/jquery/jquery.postmessage-transport-1.1.1.js"></script>
<script src="../../resource/framework/jp/jp.js"></script>

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../../resource/js/ie10-viewport-bug-workaround.js"></script>
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="../../resource/js/html5shiv.min.js"></script>
  <script src="../../resource/js/respond.min.js"></script>
<![endif]--> 
<!--[if gte IE 8]><script src="../../resource/js/jquery/jquery.xdr-transport-1.1.3.js"></script></script><![endif]-->
</html>

<script type="text/javascript">
var docWidth = $(document).width();
var currentWebsiteTag = "";
var currentWebsiteTagIndex = 100000;
// --------------------------------------------------- init Page ---------------------------------------------
setPage(currentLanguage);
function setPage(lang) {
  if (lang == "zh_CN") {
	loadJs("i18nZhCnJs");
	$("#img-language").attr("src", jp.resourceRoot + "/image/ic_flag_cn.png");
  } else {
	loadJs("i18nEnSgJs");
	$("#img-language").attr("src", jp.resourceRoot + "/image/ic_flag_us.png");
  }
  var loadI18nTimeout = setInterval(function () {
	if (I18N) {
	  if ((currentLanguage=="en_SG"&&I18N.home=="Home") || (currentLanguage=="zh_CN"&&I18N.home=="首页")) {
	    setTextInPage();
	    clearTimeout(loadI18nTimeout);
	  }
	}
  }, 100);
}
function setTextInPage() {
  $("#title").text(I18N.brandName);
  $("#brand-name").text(I18N.brandName);
  $("#menu-home").text(I18N.home);
  $("#menu-websites").text(I18N.websites);
  $("#menu-articles").text(I18N.articles);
  $("#menu-images").text(I18N.images);
  $("#menu-audios").text(I18N.audios);
  $("#menu-videos").text(I18N.videos);
  $("#menu-download").text(I18N.download);
  $("#btn-login").text(I18N.login);
  
  $("#login-title").text(I18N.loginTitle);
  $("#user-cd").attr("placeholder", I18N.loginWay); 
  $("#password").attr("placeholder", I18N.password);
  
  $("#save-tags").text(I18N.save);
  
  $("#website-name").attr("placeholder", I18N.wesiteName);
  $("#website-url").attr("placeholder", I18N.websiteUrl);
  $("#website-logo-url").attr("placeholder", I18N.websiteLogoUrl);
  $("#website-tag").attr("data-placeholder", I18N.chooseTags);
  $("#website-display-no").attr("placeholder", I18N.displayNo);
  $("#website-role-id").attr("data-placeholder", I18N.chooseRoles);
  $("#website-form .chosen-select").trigger("chosen:updated");
  $("#website-caption-name").text(I18N.websites);
  $("#add-website").text(I18N.add);
  $("#edit-website").text(I18N.edit);
  $("#save-website").text(I18N.save);
  $("#cancel-website").text(I18N.cancel);
  $("#add-website-title").text(I18N.addWebsiteTitle);
  
  //$("#").text(I18N.);
  if (jpingRoleIds!=null && jpingRoleIds.length>=32) {
	$("#login-out-menu").html("<i class='fa fa-sign-out fa-fw'></i> " + I18N.logout + "</a>");
  } else {
	$("#menu-login").text(I18N.login);
  }
}

//------------------------------ Login ------------------------------
function showLoginPanelOrLogout() {
  if ($("#login-out-menu").attr("name") == "login") {
	$.magnificPopup.open({items: { src: "#login-in-panel" }, type: 'inline', callbacks: {
	  open: function() {
	    setTimeout(function() { $("#user-cd").focus(); }, 100);
	  }	  
	}});
  } else {
	sessionStorage.removeItem(jp.keyRoleIdNames);
	$("#login-out-menu").html("<i class='fa fa-sign-in fa-fw'></i> " + I18N.login + "</a>");
	$("#login-out-menu").attr("name","login");
	$("#website-roles").hide();
	$("#website-cells").html("");
	$("#website-role-id").html("");
	$("#role-ids").html("");
	$("#role-ids-div").hide();
	$("#website-form .chosen-select").trigger("chosen:updated");
	
	jpingRoleIds = "empty";
	asynWebsiteInfos();
	$("#edit-website-btn").hide();
  }
}
function login() {
  if ($('#login-form').validate().form()) {
	$("#login-btn").hide();
	$("#login-processing-icon").show();
	$("#login-form").ajaxSubmit({dataType:'json', success : function(resp) {
	  $("#login-btn").show();
	  $("#login-processing-icon").hide();
	  if (resp.result=="success") {
		$("#user-cd").val("");
		$("#password").val("");
		sessionStorage.setItem(jp.keyRoleIdNames, resp.data.roleIdNames);
		jpingRoleOptionsHtml = getRoleOptionsHtml();
		jpingRoleIds = getRoleIds();
		asynWebsiteInfos();
		$("#login-out-menu").html("<i class='fa fa-sign-out fa-fw'></i> " + I18N.logout + "</a>");
		$("#login-out-menu").attr("name","logout");
		$("#website-role-id").html(jpingRoleOptionsHtml);
		$("#website-roles").show();
		$("#role-ids").html(jpingRoleOptionsHtml);
		$("#role-ids-div").show();
		$("#website-form .chosen-select").trigger("chosen:updated");
		
		if ((jpingRoleIds.indexOf("4028d98139636d9d01396370224d0006")!=-1 || jpingRoleIds.indexOf("4028d98139943adc0139943e5fa60040")!=-1)) {
	  		$("#edit-website-btn").show();
	  	}
		$.magnificPopup.close();
		asynWebsiteInfos();
	  } else {
		$("#login-error-info").html("Password is wrong.");
	  }
	}});
  }
}
function changeLanguage(lang) {
  setCurrentLanguage(lang);
  setPage(lang);
  asynWebsiteInfos();
}

function dismiss() {
  $.magnificPopup.close();
}

//--------------------------------------- search ----------------------------------
function filter(el) {
  var value = $(el).val().toLowerCase();
  totalNumber = 0;
  $("#website-cells .jp-cell").each(function(index) {
	var filter = $(this).attr("filter");
	if (filter) {
		filter = filter.toLowerCase();
	} else {
		filter = "";
	}
	
	var valueArr = value.split("&");
	var isContain = true;
	for (var i=0; i < valueArr.length; i++) {
		if (valueArr[i]!=null && valueArr[i]!="") {
			if (valueArr[i].indexOf("|")!=-1) {
				var orValueArr = valueArr[i].split("|");
				var isContainWithOr = false;
				for (var k=0; k < orValueArr.length; k++) {
					if (orValueArr[k]!=null && orValueArr[k]!="" && filter.indexOf(orValueArr[k])!=-1) {
						isContainWithOr = true;
						break;
					}
				}
				if (isContainWithOr==false) {
					isContain = false;
					break;
				}
			} else {
				if (valueArr[i].indexOf("!=")!=-1 || valueArr[i].indexOf("<>")!=-1) {
					var notValue = valueArr[i].substring(2);
					if (notValue=="" || filter.indexOf(notValue) == -1) {
						isContain = true;
					} else {
						isContain = false;
					}
					if (isContain == false) {
						break;
					}
				} else {
					if (filter.indexOf(valueArr[i]) == -1) {
						isContain = false;
						break;
					}	
				}
			}
		}
	}
	
	if (isContain==false) {
		$(this).hide();
	} else {
		totalNumber++;
		$(this).show();
	}
  });
  $("#totalNumber").text(totalNumber);
}
function search() {
  var keywords = $("#keywords").val();
  var field = $("#field").val();
  var lang = $("#search-lang").val();
  var roleIds = $("#role-ids").val();
  if (roleIds) {
	  roleIds = "only" + roleIds;
  } else {
	  roleIds = jpingRoleIds;
  }
  if (!keywords) {
	  keywords = "all";
  }
  var orderBy = $("#order-by").val();
  getWebsiteInfos(keywords,field,roleIds,lang,orderBy);
  asynTags();
} 
function asynWebsiteInfos() {
  $("#order-by").val("displayNo asc, menuName asc");
  $("#field").val("tag");
  $("#search-lang").val(currentLanguage);
  getWebsiteInfos("all","tag",jpingRoleIds,currentLanguage,"displayNo asc, menuName asc");
  asynTags();
}

function getWebsiteInfos(keywords,field,roleIds,lang,orderBy) {
  $("#website-cells").html("<div class='jp-tc jp-theme-color'><i class='fa fa-spinner fa-spin fa-3x' style='margin-top:50px;'></i></div>");
  var getWebsiteInfosUrl = "http://www.ganjianping.com:8080/jping/web/websiteInfos/" + keywords + "/" + field + "/" + roleIds + "/" + lang + "/" + orderBy;
  $.ajax({type: "GET", url: getWebsiteInfosUrl, async: true,
	success : function(response) {
	  if (response.result=="success") {
		allWebsiteInfos = response.data;
		var websitesHtml = "";
		totalNumber = 0;
		for (var i=0; i<allWebsiteInfos.length; i++) {
			var websiteInfo = allWebsiteInfos[i];
			websitesHtml += getWebsiteCellHtml(websiteInfo.uuid, websiteInfo.websiteName, websiteInfo.websiteUrl, 
							websiteInfo.websiteLogoUrl, websiteInfo.tags, websiteInfo.displayNo, websiteInfo.roleIds, websiteInfo.lang);
			totalNumber++;
		}
		$("#totalNumber").text(totalNumber);
		
		$("#website-cells").html(websitesHtml);
	  }
	},
	fail : function() {
	  $("#website-cells").html("Fail");
	}
  });
}

function getWebsiteCellHtml(uuid, websiteName, websiteUrl, websiteLogoUrl, tags, displayNo, roleIds, lang) {
   return "<a href='" + websiteUrl + "' target='_blank' style='color:black;'><div id='" + uuid + "' class='jp-cell' filter='" + tags + websiteName + "'>" + 
		"  <img src='" + websiteLogoUrl + "' height='20' style='margin-right:5px;'/>" + websiteName + 
		"</div></a><span class='website-edit-btn' style='cursor:pointer;margin-left:10px;display:none;' onclick='showWebsiteEditPanel(&#39;" + uuid 
			+ "&#39;, &#39;" + websiteName + "&#39;, &#39;" + websiteUrl + "&#39;, &#39;" + websiteLogoUrl + "&#39;, &#39;" + tags + "&#39;, &#39;" 
			+ displayNo + "&#39;, &#39;" + roleIds + "&#39;, &#39;" + lang + "&#39;)'><i class='fa fa-pencil-square-o'></i></span>";
}
//------------------------------ Website ------------------------------
function showWebsiteAddPanel() {
  $("#website-logo").hide();
  $("#website-logo").attr("src", "");
  $("#website-uuid").val("");
  $("#website-name").val("");
  $("#website-url").val("");
  $("#website-logo-url").val("");
  $("#website-lang").val(currentLanguage);
  $.magnificPopup.open({items: { src: "#website-panel" }, type: 'inline', modal: true});
  $("#website-form .chosen-select").chosen({search_contains : false});
}
function editWebsites() {
  if ($("#website-cells .website-edit-btn").is(":visible")) {
	  $("#website-cells .website-edit-btn").hide();
	  $("#website-tag-edit-btn").hide();
  } else {
	  $("#website-cells .website-edit-btn").show();
	  $("#website-tag-edit-btn").show();
  }
}
function showWebsiteEditPanel(uuid, websiteName, websiteUrl, websiteLogoUrl, tags, displayNo, roleId, lang) {
  $("#website-lang").val(lang);
  if (websiteUrl!=null && websiteUrl!="") {
	  $("#website-logo").show();
	  $("#website-logo").attr("src", websiteLogoUrl);
  } else {
	  $("#website-logo").hide();
	  $("#website-logo").attr("src", "");
  }
  $("#website-uuid").val(uuid);
  $("#website-name").val(websiteName);
  $("#website-url").val(websiteUrl);
  $("#website-logo-url").val(websiteLogoUrl);
  
  $("#website-tag").val(tags.split(","));
  
  $("#website-display-no").val(displayNo);
  if (roleId!=null && websiteUrl!="") {
	  $("#website-role-id").val(roleId.split(",")); 
  } else {
	  $("#website-role-id").val(""); 
  }
  $.magnificPopup.open({items: { src: "#website-panel" }, type: 'inline', modal: true});
  $("#website-form .chosen-select").chosen({search_contains : false});
  $("#website-form .chosen-select").trigger("chosen:updated");
}

function saveWebsite() {
  if ($('#website-form').validate().form()) {
	var websiteTags = $("#website-tag").val();
	var websiteRoleIds = $("#website-role-id").val();
	if (websiteTags==null) {
	  $("#website-tags-error").text(I18N.chooseTagsError);
	} else {
	  $("#save-website-btn").hide();
	  $("#save-website-processing-icon").show();
	  $("#website-tags").val(websiteTags);
	  $("#website-role-ids").val(websiteRoleIds);
	  
	  $("#website-form").ajaxSubmit({dataType:'json', success : function(resp) {
		$("#save-website-btn").show();
		$("#save-website-processing-icon").hide();
		if (resp.result=="success") {
		  search();
		  $("#website-name").val("");
		  $("#website-url").val("");
		  $("#website-logo-url").val("");
		  $("#website-uuid").val("");
		  $.magnificPopup.close();
		} else {
		  $("#save-website-error-info").html("Fail.");
		}
	  }});
	}
  }
}

//--------------------------------------- all tags operation ---------------------------------
function changeWebsiteTag(tag, index) {
  if (currentWebsiteTagIndex!=100000) {
	  $("#website-tag-"+currentWebsiteTagIndex).removeClass("theme-bg-color");
  }
  if (currentWebsiteTagIndex!=100000 && currentWebsiteTagIndex==index) {
	  $("#keywords").val("");
	  currentArticleTag = "";
	  currentArticleTagIndex = 100000;
  } else {
	  currentWebsiteTag = tag;
	  currentWebsiteTagIndex = index;
	  $("#website-tag-" + index).addClass("theme-bg-color");
	  $("#keywords").val(tag);
  }
  filter("#keywords");
}

function asynTags() {
  var lang = $("#search-lang").val();
  $.ajax({type: "GET", url: "http://www.ganjianping.com:8080/jping/web/tags/all/" + lang, async: true,
	success : function(response) {
	  if (response.result=="success") {
		var tagCdAndInfos = response.data;
		//website tags
		var websiteTagBtnsHtml = "";
		var websiteTagsOptionHtml = "";
		
		if (lang=="all") {
			var websiteTagInfo1;
			var websiteTagInfo2;
			if (currentLanguage=="zh_CN") {
				websiteTagInfo1 = tagCdAndInfos.websiteTagszh_CN;
				websiteTagInfo2 = tagCdAndInfos.websiteTagsen_SG;
			} else {
				websiteTagInfo1 = tagCdAndInfos.websiteTagsen_SG;
				websiteTagInfo2 = tagCdAndInfos.websiteTagszh_CN;
			}
			websiteTagBtnsHtml = getWebsiteTagBtnsHtml(websiteTagInfo1);
			websiteTagsOptionHtml = getWebsiteTagsOptionHtml(websiteTagInfo1);
			websiteTagsOptionHtml += getWebsiteTagsOptionHtml(websiteTagInfo2);
		} else {
			var websiteTagInfo = tagCdAndInfos.websiteTags;
			websiteTagBtnsHtml = getWebsiteTagBtnsHtml(websiteTagInfo);
			websiteTagsOptionHtml = getWebsiteTagsOptionHtml(websiteTagInfo);
		}
		$("#website-tag-btns").html(websiteTagBtnsHtml);
		$("#website-tag").html(websiteTagsOptionHtml);
		$("#website-form .chosen-select").trigger("chosen:updated");
	  }
	},
	fail : function() {
	  $("#website-tag-btns").html("Fail");
	}
  });
}
function getWebsiteTagBtnsHtml(websiteTagInfo) {
	var websiteTagUuid = websiteTagInfo.uuid;
	var websiteFirstSecondLevelTags = websiteTagInfo.description.split(";");
	var websiteTagBtnsHtml = "";
	for (var i=0; i<websiteFirstSecondLevelTags.length; i++) {
		var websiteFirstSecondLevelTagWithColon = websiteFirstSecondLevelTags[i];
		if (websiteFirstSecondLevelTagWithColon!="") {
			var websiteFirstSecondLevelTagArr = websiteFirstSecondLevelTagWithColon.split(":")
			var firstLevelTag = websiteFirstSecondLevelTagArr[0];
			if (websiteTagBtnsHtml!="") websiteTagBtnsHtml += "&nbsp;&nbsp;";
			websiteTagBtnsHtml += "<a class='btn btn-default btn-sm ";
			if (firstLevelTag == currentWebsiteTag) {
				websiteTagBtnsHtml += "theme-bg-color";
			}
			websiteTagBtnsHtml += "' href='javascript:changeWebsiteTag(&#39;" + firstLevelTag + "&#39;, " + i + ");' id='website-tag-" + i + "' style='margin:5px;"
			websiteTagBtnsHtml += "' style='margin-right:5px;'><i class='fa fa-tag fa-fw'></i>&nbsp;" + firstLevelTag + "</a>";
			
			if (websiteFirstSecondLevelTagArr.length>=2) {
				var secondLevelTagArr = websiteFirstSecondLevelTagArr[1].split(",");
			    websiteTagBtnsHtml += ":";
				for (var j=0; j<secondLevelTagArr.length; j++) {
					var tag = secondLevelTagArr[j];
					websiteTagBtnsHtml += "<a class='btn btn-default btn-sm ";
					if (tag == currentWebsiteTag) {
						websiteTagBtnsHtml += "theme-bg-color";
					}
					websiteTagBtnsHtml += "' href='javascript:changeWebsiteTag(&#39;" + tag + "&#39;,&#39;" + i + '-' + j + "&#39;);' id='website-tag-" + i + "-" + j + "' style='margin:5px;"
					websiteTagBtnsHtml += "'>" + tag + "</a>";
					
				}
			}
			
		}
	}
	websiteTagBtnsHtml += "<br/><span id='website-tag-edit-btn' style='cursor:pointer;margin-left:10px;display:none;' onclick='showTagEditPanel(&#39;" + websiteTagUuid 
		+ "&#39;, &#39;" + websiteTagInfo.cd + "&#39;, &#39;" + websiteTagInfo.description + "&#39;)'><i class='fa fa-pencil-square-o'></i></span>";
	return websiteTagBtnsHtml;
}
function getWebsiteTagsOptionHtml(websiteTagInfo) {
	var websiteTagUuid = websiteTagInfo.uuid;
	var websiteFirstSecondLevelTags = websiteTagInfo.description.split(";");
	var websiteTagsOptionHtml = "";
	for (var i=0; i<websiteFirstSecondLevelTags.length; i++) {
		var websiteFirstSecondLevelTagWithColon = websiteFirstSecondLevelTags[i];
		if (websiteFirstSecondLevelTagWithColon!="") {
			var websiteFirstSecondLevelTagArr = websiteFirstSecondLevelTagWithColon.split(":")
			var firstLevelTag = websiteFirstSecondLevelTagArr[0];
			websiteTagsOptionHtml += "<option value='" + firstLevelTag + "' style='font-weight:bold;'>" + firstLevelTag + "</option>";
			
			if (websiteFirstSecondLevelTagArr.length>=2) {
				var secondLevelTagArr = websiteFirstSecondLevelTagArr[1].split(",");
			    for (var j=0; j<secondLevelTagArr.length; j++) {
					var tag = secondLevelTagArr[j];
					websiteTagsOptionHtml += "<option value='" + tag + "' style='margin-left:5px'>  " + tag + "</option>";
				}
			}
			
		}
	}
	return websiteTagsOptionHtml;
}
function showTagEditPanel(uuid, cd, tags) {
  if (cd=="websiteTags") {
	$("#tags-title").html("Website Tags");
  }
  $("#tags-uuid").val(uuid);
  $("#two-level-tags").val(tags);
  $.magnificPopup.open({items: { src: "#tags-panel" }, type: 'inline', modal: true});
}
function saveTags() {
  $("#save-tags-btn").hide();
  $("#save-tags-processing-icon").show();
  $("#tags-form").ajaxSubmit({dataType:'json', success : function(resp) {
	$("#save-tags-btn").show();
	$("#save-tags-processing-icon").hide();
	if (resp.result=="success") {
	  asynTags();
	  $.magnificPopup.close();
	} else {
	  $("#save-tags-error-info").html("Fail.");
	}
  }});
}

//--------------------------------------- Processing ---------------------------------
function showProcessingPanel() {
  $.magnificPopup.open({items: { src: "#processing-panel" }, type: 'inline', modal:true});
}
var currentBgColor = "white";
var currentColor = "black";
function changeBackground(elId){
  if (currentBgColor=="white") {
	  currentBgColor = "#333"; 
	  currentColor = "white";
  } else {
	  currentBgColor = "white"; 
	  currentColor = "black";
  }
  $("#" + elId).css("background-color",currentBgColor).css("color",currentColor);
  $(".mfp-close").css("color",currentColor);
}

$(document).ready(function(){
  //-------------------------- Init : magnificPopup, asyn tags,  ----------------------------
  $('.popup-with-form').magnificPopup();
  asynWebsiteInfos();
  if (jpingRoleIds!=null && jpingRoleIds.length>=32) {
	$("#website-role-id").html(jpingRoleOptionsHtml);
	$("#website-roles").show();
	$("#role-ids").html(jpingRoleOptionsHtml);
	$("#role-ids-div").show();
	$("#login-out-menu").attr("name","logout");
	if ((jpingRoleIds.indexOf("4028d98139636d9d01396370224d0006")!=-1 || jpingRoleIds.indexOf("4028d98139943adc0139943e5fa60040")!=-1)) {
  		$("#edit-website-btn").show();
  	}
  }
  //-------------------------- Login -----------------------------
  $('#login-form').validate({
  	errorElement: 'span', //default input error message container
  	errorClass: 'help-block', // default input error message class
  	focusInvalid: false, // do not focus the last invalid input
  	rules: {
      userCd: {required: true},
      password: {required: true}
  	},
  	messages: {
  	  userCd: {required: "Please enter user name or mobile number or email."},
  	  password: {required: "Please enter password."}
  	},
  	invalidHandler:function(form, validator) {var errors = validator.numberOfInvalids(); if (errors) {validator.errorList[0].element.focus();}},
    success: function (label) {label.closest('.form-control').removeClass('has-error'); label.remove(); },
    errorPlacement: function (error, element) {error.insertAfter(element.parent()); error.css('color', 'red').css("margin-left","1px");},
  });
  $("#user-cd,#password").focus(function() {
	  $("#login-error-info").html("");
  });
  
//------------------------ Search ------------------------------
  $("#website-tags-btn").click(function() {
	if ($("#website-tag-btns").is(":visible")) {
	  $("#website-tag-btns").hide();
	  $("#website-tags-btn").css("background-color","#eee").css("color","#333");
	} else {
	  $("#website-tag-btns").show();
	  $("#website-tags-btn").css("background-color","#1abc9c").css("color","#fff");
	}
  });
  $("#website-tags-btn").click();
  $("#search-condition-btn").click(function() {
	  if ($("#search-condition-div").is(":visible")) {
		  $("#search-condition-div").hide();
		  $("#search-condition-btn").css("background-color","#eee").css("color","#333");
	  } else {
		  $("#search-condition-div").show();
		  $("#search-condition-btn").css("background-color","#1abc9c").css("color","#fff");
	  }
  });
  $("#operation-btn").click(function() {
	  if ($("#website-operate-btns").is(":visible")) {
		  $("#website-operate-btns").hide();
		  $("#operation-btn").css("background-color","#eee").css("color","#333");
	  } else {
		  $("#website-operate-btns").show();
		  $("#operation-btn").css("background-color","#1abc9c").css("color","#fff");
	  }
  });
  $("#search-btn").click(function() {
	  search();
  })
  $("#keywords").keyup(function( event ) {
    if ( event.which == 13 ) {
	    event.preventDefault();
	} else {
		filter(this);
	}
  });
  $("#role-ids,#order-by,#search-lang,#field").change(function() {
	  search();
  });
  
  //-------------------------- Website ---------------------------
  $("#website-caption").click(function() {
	if ($("#website-tag-btns").is(":visible")) {
	  $("#website-tag-btns").hide();
	} else {
	  $("#website-tag-btns").show();
	}
  });
  $('#website-form').validate({
  	errorElement: 'span', //default input error message container
  	errorClass: 'help-block', // default input error message class
  	focusInvalid: false, // do not focus the last invalid input
  	rules: {
      websiteName: {required: true, maxlength:100},
      websiteUrl: {required: true, maxlength:256},
      websiteLogoUrl: {maxlength:256}
  	},
  	messages: {
  	  websiteName: {required: "Please enter website name."},
  	  websiteUrl: {required: "Please enter url."}
  	},
  	invalidHandler:function(form, validator) {var errors = validator.numberOfInvalids(); if (errors) {validator.errorList[0].element.focus();}},
    success: function (label) {label.closest('.form-control').removeClass('has-error'); label.remove(); },
    errorPlacement: function (error, element) {error.insertAfter(element.closest('.form-control'));error.css('color', 'red');},
    submitHandler: function (form) {form.submit();}
  });
  $("#website-tag").change(function() {
	if ($(this).val()==null) {
		$("#website-tags-error").text(I18N.chooseTagsError);
	} else {
		$("#website-tags-error").text("");
	} 
  });
  $('#upload-website-logo-btn').fileupload({
	maxChunkSize: 10000000, // 10 MB
    dataType: 'json',
    done: function (e, data) {
      if (data.result.result == "success") {
    	$("#website-logo").show();
    	$("#website-logo-url").val(data.result.saveUrl);
    	$("#website-logo").attr("src", data.result.saveUrl);
      } else {
    	if (data.result.saveUrl!=null && data.result.saveUrl.indexOf("http")!=-1) {
    	  $("#website-logo").show();
    	  $("#website-logo-url").val(data.result.saveUrl);
          $("#website-logo").attr("src", data.result.saveUrl);
    	}
    	alert(data.result.result);
      }
    }
  });
  $("#website-name,#website-url,#website-tag,#website-logo-url,#website-role-id").focus(function() {
	  $("#save-website-error-info").html("");
  });
});
</script>
